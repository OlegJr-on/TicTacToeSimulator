# API Contract Summary

## Headers

- **X-Correlation-Id**: Optional UUID. Generated by UI on "Start", propagated to Session and Engine. All services log and include in RFC7807 responses and Kafka events.

## Game Engine Service (port 8081)

| Method | Path | Description |
|--------|------|-------------|
| POST | /games | Create game. Response: GameDto. |
| GET | /games/{gameId} | Get game. Response: GameDto. 404 if not found. |
| POST | /games/{gameId}/move | Apply move. Body: `{ "moveId": "uuid", "player": "X"\|"O", "row": 0-2, "col": 0-2 }`. Response: GameDto. Idempotent by moveId. 400 invalid move, 409 game finished. |

## Game Session Service (port 8082)

| Method | Path | Description |
|--------|------|-------------|
| POST | /sessions | Create session and engine game. Response: SessionDto (simulationStatus CREATED). |
| POST | /sessions/{sessionId}/simulate | Start async simulation. Response: 202 Accepted. 409 if already running. |
| GET | /sessions/{sessionId} | Get session (game snapshot + move history). 404 if not found. |

## Error format (RFC7807)

All services return `Content-Type: application/problem+json` with:

- type, title, status, detail, instance
- Extensions: correlationId, errorCode

Error codes: INVALID_MOVE, GAME_FINISHED, GAME_NOT_FOUND, SESSION_NOT_FOUND, SIMULATION_ALREADY_RUNNING, ENGINE_UNAVAILABLE.

## Kafka

- Topic: `tictactoe.game.events.v1`
- Event: GameUpdatedEvent (eventType, eventVersion, eventId, correlationId, occurredAt, gameId, moveNumber, lastMove, status, winner, board)
- Producer: Engine (after each accepted move)
- Consumer: Session (audit/log)
